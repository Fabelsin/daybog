Спочатку ми отримуємо права адміністратора та створюємо "чистого" користувача, щоб наші
ліміти не конфліктували із системними процесами.
# 1. Переходимо в режим суперкористувача (Root)
# '-' означає повне завантаження середовища root
su -
# 2. Створюємо нового користувача 'student'
# -m : створити домашню директорію (/home/student)
# -s /bin/bash : встановити оболонку bash за замовчуванням
useradd -m -s /bin/bash student
# 3. Встановлюємо пароль для користувача (наприклад, '1')
passwd student
Етап 2: Налаштування лімітів (User Limits)
Переходимо до користувача student і виконуємо завдання з обмеження ресурсів.
# 1. Заходимо під створеним користувачем
su - student
# 2. Показати всі поточні обмеження
# -a : all (показати всі параметри)
ulimit -a
# 3. Встановити м’яке обмеження на кількість відкритих файлів (50)
# -S : Soft limit (м'яке обмеження, попередження)
# -n : open files (кількість відкритих файлів)
ulimit -S -n 50
# Перевірка (має вивести 50)
ulimit -n
# 4. Встановити обмеження розміру файлу (1 КБ)
# -f : file size (розмір файлу у блоках, 1 блок = 1024 байти)
ulimit -f 1
# Спроба створити файл більшого розміру (тест)
# dd : утиліта для копіювання даних
# if=/dev/zero : джерело (нескінченні нулі)
# of=testfile : куди записувати
# bs=2048 : розмір порції даних (2 КБ)
# count=1 : записати 1 раз
dd if=/dev/zero of=testfile bs=2048 count=1
# (Очікувана помилка: File size limit exceeded)
# 5. Встановити обмеження на процесор (5 секунд)
# -t : cpu time (час процесора в секундах)
ulimit -t 5
# Запуск нескінченного циклу для тесту
# while true : поки істина (завжди)
# do :; : виконувати "нічого"
# done : кінець циклу
while true; do :; done
# (Очікувана подія: 'Killed' — система вбиває процес через 5 сек)
Етап 3: Ліміт процесів (після перезаходу)
Попередній тест викинув нас із сесії. Заходимо знову для налаштування кількості процесів.
# 1. Знову заходимо в користувача student
su - student
# 2. Встановити жорстке обмеження на 5 процесів
# -u : user processes (кількість процесів користувача)
# Ми не пишемо -H (Hard) окремо, щоб змінити і м'який ліміт теж,
# це запобігає помилці "Invalid argument".
ulimit -u 5
# 3. Спроба запустити 6 фонових процесів
# for i in {1..6} : цикл від 1 до 6
# sleep 20 : команда "чекати" 20 секунд
# & : запустити у фоні (паралельно)
for i in {1..6}; do sleep 20 & done
# (Очікувана помилка: Resource temporarily unavailable)
# 4. Виходимо з користувача student назад у root
exit
Етап 4: Ізоляція та монтування (Namespaces)
Це завдання виконується з правами root.
# 1. Запуск оболонки в ізольованому просторі
# unshare : від'єднати частину ресурсів від батьківського процесу
# --mount : створити власний простір монтування (дисків)
# --propagation private : зміни монтування не передаються в основну систему
unshare --mount --propagation private /bin/bash
# 2. Створюємо тимчасову папку для точки монтування
mkdir /tmp/iso_lab
# 3. Монтуємо файлову систему
# mount : підключити диск
# -t tmpfs : тип файлової системи (тимчасова, в оперативній пам'яті)
# tmpfs : назва пристрою (умовна)
# /tmp/iso_lab : куди монтувати
mount -t tmpfs tmpfs /tmp/iso_lab
# 4. Перевірка
# df : disk free (показати диски)
# -h : human readable (у зрозумілому форматі)
# grep : фільтрація рядка за назвою папки
df -h | grep iso_lab
# 5. Завершення
exit # Вихід з ізольованої оболонки
exit # Вихід з root (повернення до звичайного користувача)
