Встановити Bind9 з базовими налаштуваннями безпеки (включаючи ACL)
та логування, з субдоменом та прямою і зворотньою зоною. Обовязкові
ресурсні записи: MX, CNAME, TXT, SRV.

Вхідні дані
• Доменна зона: lab.local
• Мережа: 192.168.197.0/24
• IP сервера (Bind9): 192.168.197.10
 
Крок 1: Встановлення та підготовка
Оновлюємо списки пакетів та встановлюємо Bind9.
Bash
sudo apt update
sudo apt install bind9 bind9utils bind9-doc -y
Пояснення: Пакет bind9 — це сам сервер, bind9utils містить утиліти для перевірки (як-от named-checkconf), а bind9-doc — документацію.
 
Крок 2: Налаштування безпеки (ACL) та опцій
Редагуємо файл named.conf.options. Це головний файл налаштувань поведінки сервера.
Bash
sudo nano /etc/bind/named.conf.options
Видаліть старий вміст і вставте цей. Я додав коментарі до кожного важливого блоку:
DNS Zone file
# 1. ACL (Access Control List) - Список "своїх"
# Ми створюємо групу "trusted", якій дозволимо робити запити.
acl "trusted" {
       192.168.197.0/24; # Ваша локальна мережа
       localhost;        # Сам сервер
       localnets;
};
 
options {
       directory "/var/cache/bind";
 
       # 2. БЕЗПЕКА
       recursion yes;                 # Дозволяємо серверу шукати адреси в інтернеті (google.com тощо)
       allow-query { trusted; };      # Але відповідаємо лише тим, хто в списку "trusted"
       allow-transfer { none; };      # Забороняємо скачувати повну копію зони (захист від хакерів)
 
       # 3. МЕРЕЖА
       # Слухаємо лише на IPv4 вашої мережі та локальному інтерфейсі
       listen-on { 192.168.197.10; localhost; };
       
       # Вимикаємо IPv6, щоб у логах і при dig не було помилок "connection refused"
       listen-on-v6 { none; };
 
       # 4. FORWARDERS (Пересилачі)
       # Якщо Bind не знає відповіді (наприклад, youtube.com), він спитає тут:
       forwarders {
               8.8.8.8;
               1.1.1.1;
       };
};
 
Крок 3: Налаштування Логування
В завданні вимагається логування. Щоб Bind міг писати логи у свій файл, потрібно створити папку і дати права користувачу bind.
Додаємо налаштування логів у кінець файлу named.conf.options (або named.conf): Відкрийте той самий файл (sudo nano /etc/bind/named.conf.options) і допишіть в самий низ після закриваючої дужки };:
DNS Zone file
logging {
   channel custom_log {
       file "/var/log/named/bind.log" versions 3 size 5m;
       severity info;          # Рівень деталізації (info - оптимально)
       print-time yes;         # Додавати час у лог
       print-severity yes;
       print-category yes;
   };
   category default { custom_log; };
   category queries { custom_log; }; # Логувати всі запити клієнтів (хто куди заходив)
};
Створюємо папку (Критичний крок): Без цього сервіс впаде з помилкою.
Bash
sudo mkdir -p /var/log/named
sudo chown bind:bind /var/log/named
sudo chmod 755 /var/log/named
 
Крок 4: Оголошення Зон
Тепер кажемо серверу, що він відповідає за домен lab.local і мережу 192.168.197.x.
Відкриваємо файл:
Bash
sudo nano /etc/bind/named.conf.local
Вставляємо:
DNS Zone file
# Пряма зона: Перетворює імена (lab.local) в IP
zone "lab.local" {
   type master;
   file "/etc/bind/zones/db.lab.local";
};
 
# Зворотна зона: Перетворює IP в імена.
# Адреса мережі пишеться у зворотному порядку без останнього октету.
# 192.168.197.0 -> 197.168.192.in-addr.arpa
zone "197.168.192.in-addr.arpa" {
   type master;
   file "/etc/bind/zones/db.192.168.197";
};
Створимо папку для файлів зон, щоб був порядок:
Bash
sudo mkdir -p /etc/bind/zones
 
Крок 5: Файл Прямої зони (MX, SRV, TXT, CNAME)
Це "база даних" вашого домену.
Створюємо файл:
Bash
sudo nano /etc/bind/zones/db.lab.local
Вставляємо (уважно з крапками в кінці доменів!):
DNS Zone file
;
; BIND data file for lab.local
;
$TTL    604800
@       IN      SOA     ns1.lab.local. admin.lab.local. (
                             3         ; Serial (Збільшуйте це число при кожній зміні!)
                        604800         ; Refresh
                         86400         ; Retry
                       2419200         ; Expire
                        604800 )       ; Negative Cache TTL
;
; NS (Name Server) - Хто головний на районі
@       IN      NS      ns1.lab.local.
 
; A Records - Співставлення імен та IP
@       IN      A       192.168.197.10
ns1     IN      A       192.168.197.10
mail    IN      A       192.168.197.10
sip     IN      A       192.168.197.10
 
; --- ВИМОГИ ЗАВДАННЯ ---
 
; 1. MX (Mail Exchange) - Вказує, куди слати пошту
; Пріоритет 10, сервер mail.lab.local
@       IN      MX      10 mail.lab.local.
 
; 2. CNAME (Canonical Name) - Псевдонім
; Якщо хтось питає www.lab.local, це те саме, що ns1
www     IN      CNAME   ns1.lab.local.
 
; 3. TXT (Text) - Інформаційний запис
; Найчастіше використовується для SPF (захист пошти від спаму)
@       IN      TXT     "v=spf1 mx -all"
info    IN      TXT     "Demo Server"
 
; 4. SRV (Service) - Де знайти конкретний сервіс (наприклад, SIP/VoIP)
; Формат: _service._proto.name TTL IN SRV priority weight port target
_sip._tcp.lab.local.  IN      SRV     10 60 5060 sip.lab.local.
 
; 5. Субдомен (прямо тут)
dev     IN      A       192.168.197.20
 
Крок 6: Файл Зворотної зони
Дозволяє дізнатися ім'я комп'ютера, знаючи його IP.
Створюємо файл:
Bash
sudo nano /etc/bind/zones/db.192.168.197
Вставляємо:
DNS Zone file
;
; Reverse zone for 192.168.197.x
;
$TTL    604800
@       IN      SOA     ns1.lab.local. admin.lab.local. (
                             1         ; Serial
                        604800         ; Refresh
                         86400         ; Retry
                       2419200         ; Expire
                        604800 )       ; Negative Cache TTL
;
@       IN      NS      ns1.lab.local.
 
; PTR Records (Pointer)
; Тут пишемо лише останню цифру IP адреси
10      IN      PTR     ns1.lab.local.
10      IN      PTR     mail.lab.local.
20      IN      PTR     dev.lab.local.
 
Крок 7: Перевірка та Запуск
1. Перевірка синтаксису конфігу:
Bash
sudo named-checkconf
(Має бути пусто).
2. Перевірка зон:
Bash
sudo named-checkzone lab.local /etc/bind/zones/db.lab.local
sudo named-checkzone 197.168.192.in-addr.arpa /etc/bind/zones/db.192.168.197
(Має писати OK).
3. Перезапуск служби:
Bash
sudo systemctl restart bind9
sudo systemctl status bind9
(Має світитися зеленим active (running)).
 
Крок 8: Фінальна демонстрація (Для звіту)
Використовуйте ці команди. Прапорець -4 прибере помилки connection refused, що були на вашому скріншоті, і зробить вивід чистим.
1. Загальна перевірка (A запис):
Bash
dig -4 @192.168.197.10 lab.local +short
2. Перевірка субдомену:
Bash
dig -4 @192.168.197.10 dev.lab.local +short
3. Перевірка пошти (MX):
Bash
dig -4 @192.168.197.10 lab.local MX +short
4. Перевірка аліасу (CNAME):
Bash
dig -4 @192.168.197.10 www.lab.local +short
5. Перевірка TXT запису:
Bash
dig -4 @192.168.197.10 lab.local TXT +short
6. Перевірка SRV запису:
Bash
dig -4 @192.168.197.10 _sip._tcp.lab.local SRV +short
7. Перевірка зворотної зони (PTR):
Bash
dig -4 @192.168.197.10 -x 192.168.197.20 +short
8. Демонстрація логування: Зробіть скріншот виводу цієї команди:
Bash
sudo tail -n 10 /var/log/named/bind.log
Тепер у вас повністю налаштований сервер з урахуванням усіх нюансів вашої мережі.
