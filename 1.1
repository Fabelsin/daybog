ğŸ“„ /etc/pam.d/common-password
(ÑĞºĞ»Ğ°Ğ´Ğ½Ñ–ÑÑ‚ÑŒ + Ñ–ÑÑ‚Ğ¾Ñ€Ñ–Ñ Ğ¿Ğ°Ñ€Ğ¾Ğ»Ñ–Ğ²)
# PAM password configuration
password requisite pam_pwquality.so retry=3 minlen=8 dcredit=-1
ucredit=-1
password [success=1 default=ignore] pam_unix.so obscure use_authtok
sha512 remember=3
password required pam_deny.so
ğŸ“„ /etc/pam.d/common-auth
âš ï¸ Ğ‘Ğ•Ğ— pam_faillock â€” Ñ–Ğ½Ğ°ĞºÑˆĞµ su Ğ·Ğ»Ğ°Ğ¼Ğ°Ñ”Ñ‚ÑŒÑÑ
# PAM authentication configuration
auth required pam_env.so
auth sufficient pam_unix.so nullok_secure
auth requisite pam_deny.so
auth required pam_permit.so
ğŸ“„ /etc/pam.d/common-account
(pam_time Ğ´Ğ»Ñ student)
# PAM account configuration
account required pam_time.so
account required pam_unix.so
ğŸ“„ /etc/pam.d/common-session
(pam_motd)
# PAM session configuration
session required pam_unix.so
session optional pam_motd.so motd=/run/motd.dynamic
session optional pam_motd.so noupdate
ğŸ“„ /etc/pam.d/login
ğŸ‘‰ Ğ‘Ğ»Ğ¾ĞºÑƒĞ²Ğ°Ğ½Ğ½Ñ Ğ¢Ğ†Ğ›Ğ¬ĞšĞ˜ user666 (Ğ»Ğ¾ĞºĞ°Ğ»ÑŒĞ½Ğ¸Ğ¹ Ğ²Ñ…Ñ–Ğ´)
# PAM configuration for login
auth [success=2 default=ignore] pam_succeed_if.so user = user666
auth required pam_faillock.so preauth silent audit deny=3
unlock_time=300
auth [default=die] pam_faillock.so authfail deny=3 unlock_time=300
auth sufficient pam_faillock.so authsucc
@include common-auth
@include common-account
@include common-session
@include common-password
ğŸ“„ /etc/pam.d/sshd
ğŸ‘‰ Ğ¢Ğ• Ğ¡ĞĞœĞ•, Ğ°Ğ»Ğµ Ğ´Ğ»Ñ SSH
# PAM configuration for sshd
auth [success=2 default=ignore] pam_succeed_if.so user = user666
auth required pam_faillock.so preauth silent audit deny=3
unlock_time=300
auth [default=die] pam_faillock.so authfail deny=3 unlock_time=300
auth sufficient pam_faillock.so authsucc
@include common-auth
@include common-account
@include common-session
@include common-password
ğŸ“Œ Ğ¢ĞµĞ¿ĞµÑ€:
â— ssh user666@host â†’ Ğ±Ğ»Ğ¾ĞºÑƒÑ”Ñ‚ÑŒÑÑ Ğ¿Ñ–ÑĞ»Ñ 3 Ğ¿Ğ¾Ğ¼Ğ¸Ğ»Ğ¾Ğº
â— ssh student@host â†’ ĞĞ• Ğ±Ğ»Ğ¾ĞºÑƒÑ”Ñ‚ÑŒÑÑ
ğŸ“„ /etc/security/time.conf
(Ğ¾Ğ±Ğ¼ĞµĞ¶ĞµĞ½Ğ½Ñ Ñ‡Ğ°ÑÑƒ Ğ´Ğ»Ñ student)
# service;tty;user;time
*;*;student;Al0800-1800
ğŸ“„ /etc/pam.d/login (pam_securetty
Ğ´Ğ»Ñ root â€” ÑĞº Ñƒ Ğ²Ğ¸Ğ¼Ğ¾Ğ³Ğ°Ñ…)
ĞŸĞµÑ€ĞµĞºĞ¾Ğ½Ğ°Ğ¹ÑÑ, Ñ‰Ğ¾ Ñ€ÑĞ´Ğ¾Ğº Ñ” Ñ– ĞĞ• Ğ·Ğ°ĞºĞ¾Ğ¼ĞµĞ½Ñ‚Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğ¹:
auth [success=ok ignore=ignore user_unknown=ignore default=bad]
pam_securetty.so
(Ñ†Ğµ ÑÑ‚Ğ°Ğ½Ğ´Ğ°Ñ€Ñ‚, Ğ·Ğ°Ğ·Ğ²Ğ¸Ñ‡Ğ°Ğ¹ ÑƒĞ¶Ğµ Ñ”)
ğŸ‘¤ ĞšĞ¾Ñ€Ğ¸ÑÑ‚ÑƒĞ²Ğ°Ñ‡Ñ–
useradd -m user666
passwd user666
usermod -aG sudo user666
useradd -m student
passwd student
ğŸ”‘ SSH (ĞĞ‘ĞĞ’Ê¼Ğ¯Ğ—ĞšĞĞ’Ğ)
Ğ’ /etc/ssh/sshd_config Ğ¿ĞµÑ€ĞµĞ²Ñ–Ñ€:
UsePAM yes
ĞŸĞ¾Ñ‚Ñ–Ğ¼:
systemctl restart ssh
# Ğ°Ğ±Ğ¾
service ssh restart
âœ… ĞŸĞ•Ğ Ğ•Ğ’Ğ†Ğ ĞšĞ (Ğ”Ğ›Ğ¯ Ğ—ĞĞ¥Ğ˜Ğ¡Ğ¢Ğ£)
faillock --reset
âŒ user666:
login user666
ssh user666@localhost
faillock --user user666
âœ… Ñ” Ğ·Ğ°Ğ¿Ğ¸ÑĞ¸
âœ… student:
login student
ssh student@localhost
faillock --user student
âœ… Ğ¿Ğ¾Ñ€Ğ¾Ğ¶Ğ½ÑŒĞ¾
âœ… su:
su student
su user666
âœ… Ğ¿Ñ€Ğ°Ñ†ÑÑ”
