–í—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏ Bind9 –∑ –±–∞–∑–æ–≤–∏–º–∏ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è–º–∏ –±–µ–∑–ø–µ–∫–∏ (–≤–∫–ª—é—á–∞—é—á–∏ ACL)
—Ç–∞ –Ω–∞–ª–∞—à—Ç—É–≤–∞—Ç–∏ DNSSEC.

1. –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è BIND9

1.1 –û–Ω–æ–≤–∏—Ç–∏ —Å–∏—Å—Ç–µ–º—É

sudo apt update

sudo apt upgrade -y

 

1.2 –í—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏ BIND9 —Ç–∞ —É—Ç–∏–ª—ñ—Ç–∏

sudo apt install bind9 bind9utils bind9-dnsutils -y

 

1.3 –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏, —â–æ —Å–ª—É–∂–±–∞ –ø—Ä–∞—Ü—é—î

systemctl status bind9

2. –ë–∞–∑–æ–≤—ñ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –±–µ–∑–ø–µ–∫–∏ (named.conf.options)
–í—ñ–¥–∫—Ä–∏–≤–∞—î–º–æ –∫–æ–Ω—Ñ—ñ–≥:
sudo nano /etc/bind/named.conf.options

–ü–æ–≤–Ω—ñ—Å—Ç—é –∑–∞–º—ñ–Ω–∏ –≤–º—ñ—Å—Ç –Ω–∞ —Ü–µ

options {

   directory "/var/cache/bind";

   recursion yes;

   allow-recursion { trusted; };

   allow-query { trusted; };

   allow-transfer { none; };

   dnssec-validation auto;

   auth-nxdomain no;

   listen-on { any; };

   listen-on-v6 { none; };

};

acl trusted {

   127.0.0.1;

   192.168.193.0/24;

   192.168.195.0/24;

};

 

–©–æ —Ç—É—Ç –≤–∞–∂–ª–∏–≤–æ (–∫–æ—Ä–æ—Ç–∫–æ):

‚Ä¢ acl trusted ‚Üí —Ö—Ç–æ –º–∞—î –ø—Ä–∞–≤–æ –ø–∏—Ç–∞—Ç–∏ DNS
‚Ä¢ allow-transfer none ‚Üí –∑–∞–±–æ—Ä–æ–Ω–∞ zone transfer
‚Ä¢ dnssec-validation auto ‚Üí –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ DNSSEC
‚Ä¢ recursion yes ‚Üí –∫–µ—à—É—é—á–∏–π DNS —Ç—ñ–ª—å–∫–∏ –¥–ª—è —Å–≤–æ—ó—Ö
 

3. –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –∑–æ–Ω–∏ DNS

3.1 –î–æ–¥–∞—Ç–∏ –∑–æ–Ω—É –≤ named.conf.local

sudo nano /etc/bind/named.conf.local

–î–æ–¥–∞–π:

zone "example.local" {

   type master;

   file "/etc/bind/db.example.local";

   allow-update { none; };

};

 

3.2 –°—Ç–≤–æ—Ä–∏—Ç–∏ —Ñ–∞–π–ª –∑–æ–Ω–∏

–°–∫–æ–ø—ñ—é–≤–∞—Ç–∏ —à–∞–±–ª–æ–Ω:

sudo cp /etc/bind/db.local /etc/bind/db.example.local

–í—ñ–¥–∫—Ä–∏—Ç–∏:

sudo nano /etc/bind/db.example.local



 

4Ô∏è. –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó

sudo named-checkconf

–ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–æ–Ω–∏:

sudo named-checkzone example.local /etc/bind/db.example.local

 

5Ô∏è. –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ BIND9

sudo systemctl restart bind9

 

–ü–µ—Ä–µ–≤—ñ—Ä:

systemctl status bind9

 

6Ô∏è. –£–≤—ñ–º–∫–Ω–µ–Ω–Ω—è DNSSEC (–ø—ñ–¥–ø–∏—Å –∑–æ–Ω–∏)

6.1 –°—Ç–≤–æ—Ä–∏—Ç–∏ –∫–∞—Ç–∞–ª–æ–≥ –¥–ª—è –∫–ª—é—á—ñ–≤

sudo mkdir /etc/bind/keys

cd /etc/bind/keys

 

 

6.2 –°—Ç–≤–æ—Ä–µ–Ω–Ω—è ZSK (Zone Signing Key)

sudo dnssec-keygen -a RSASHA256 -b 2048 -n ZONE example.local

 

6.3 –°—Ç–≤–æ—Ä–µ–Ω–Ω—è KSK (Key Signing Key)

sudo dnssec-keygen -a RSASHA256 -b 4096 -n ZONE -f KSK example.local

 

–ü–µ—Ä–µ–≤—ñ—Ä:

ls

–ú–∞—î –±—É—Ç–∏:

Kexample.local.+008+XXXXX.key

Kexample.local.+008+XXXXX.private

 

7Ô∏è. –ü—ñ–¥–ø–∏—Å–∞–Ω–Ω—è DNS-–∑–æ–Ω–∏

7.1–ü–µ—Ä–µ–π–¥–∏ –≤ –∫–∞—Ç–∞–ª–æ–≥ –∑ —Ñ–∞–π–ª–æ–º –∑–æ–Ω–∏

cd /etc/bind

–ü–µ—Ä–µ–≤—ñ—Ä:

ls db.example.local

 

7.2 –°–∫–æ–ø—ñ—é–π –∫–ª—é—á—ñ –≤ /etc/bind

sudo cp /etc/bind/keys/Kexample.local.* /etc/bind/

 

–ü–µ—Ä–µ–≤—ñ—Ä:

ls Kexample.local.*

 

7.3 –í—ñ–¥–∫—Ä–∏–π —Ñ–∞–π–ª –∑–æ–Ω–∏

sudo nano /etc/bind/db.example.local

–í –ö–Ü–ù–ï–¶–¨ —Ñ–∞–π–ª—É –î–û–î–ê–ô $INCLUDE

$INCLUDE Kexample.local.+008+37087.key

$INCLUDE Kexample.local.+008+34906.key

 

7.4 –ó–±–µ—Ä–µ–∂–∏ —Ñ–∞–π–ª —ñ –ø–µ—Ä–µ–≤—ñ—Ä

sudo named-checkzone example.local /etc/bind/db.example.local

 

7.5 –¢–ï–ü–ï–† –ø—ñ–¥–ø–∏—Å–∞–Ω–Ω—è

sudo dnssec-signzone -A -o example.local db.example.local

–ü–µ—Ä–µ–≤—ñ—Ä —Ä–µ–∑—É–ª—å—Ç–∞—Ç

ls db.example.local*

‚úÖ –ú–∞—î –∑‚Äô—è–≤–∏—Ç–∏—Å—å:

db.example.local

db.example.local.signed

 

8. –í–∫–∞–∑–∞—Ç–∏ BIND –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –ø—ñ–¥–ø–∏—Å–∞–Ω—É –∑–æ–Ω—É

–í—ñ–¥–∫—Ä–∏–π:

sudo nano /etc/bind/named.conf.local

–ó–∞–º—ñ–Ω–∏:

file "/etc/bind/db.example.local";

‚úÖ –ù–∞:

file "/etc/bind/db.example.local.signed";

 

9Ô∏è. –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –ø—ñ—Å–ª—è DNSSEC

sudo systemctl restart bind9

 

10. –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ DNSSEC

10.1 –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ DNS

dig @localhost example.local +dnssec

 

–£ AUTHORITY SECTION —Ç–∏ –±–∞—á–∏—à:
RRSIG SOA
RRSIG NSEC
NSEC
üëâ –¶–µ 100% –¥–æ–∫–∞–∑, —â–æ:
‚Ä¢ –∑–æ–Ω–∞ –ø—ñ–¥–ø–∏—Å–∞–Ω–∞
‚Ä¢ RRSIG —î
‚Ä¢ DNSSEC –ø—Ä–∞—Ü—é—î
 

10.2 –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –∑–∞–ø–∏—Å—É

sudo ss -lntup | grep :53

–í–∏–±–∏—Ä–∞—î–º–æ –∞–¥—Ä–µ—Å—É 192.168.—Ö—Ö—Ö.—Ö—Ö—Ö —ñ –≤–∏–∫–æ–Ω—É—î–º–æ –∑ –Ω–µ—é  dig @192.168.—Ö—Ö—Ö.—Ö—Ö—Ö example.local +dnssec

–©–û –ú–ò –ë–ê–ß–ò–ú–û (—ñ —á–æ–º—É —Ü–µ 100% OK)

üîπ –°—Ç–∞—Ç—É—Å

status: NOERROR

‚úî –ó–∞–ø–∏—Ç –æ–±—Ä–æ–±–ª–µ–Ω–æ –∫–æ—Ä–µ–∫—Ç–Ω–æ

üîπ –ü—Ä–∞–ø–æ—Ä–∏

flags: qr aa rd ra

‚Ä¢ aa ‚Üí authoritative answer (—Ç–≤—ñ–π —Å–µ—Ä–≤–µ—Ä ‚Äî master)
‚Ä¢ rd/ra ‚Üí —Ä–µ–∫—É—Ä—Å—ñ—è –¥–æ–∑–≤–æ–ª–µ–Ω–∞ –¥–ª—è trusted ACL
üîπ DNSSEC-–¥–æ–∫–∞–∑–∏ (–ì–û–õ–û–í–ù–ï)

–£ AUTHORITY SECTION:

RRSIG SOA

RRSIG NSEC

NSEC

üëâ –¶–µ –æ–∑–Ω–∞—á–∞—î:

‚Ä¢ –∑–æ–Ω–∞ –ø—ñ–¥–ø–∏—Å–∞–Ω–∞
‚Ä¢ –ø—ñ–¥–ø–∏—Å–∏ –ø–µ—Ä–µ–≤—ñ—Ä–Ω—ñ
‚Ä¢ DNSSEC –∞–∫—Ç–∏–≤–Ω–∏–π —ñ –ø—Ä–∞—Ü—é—î
